#!/bin/sh
# Commit message hook for validating conventional commits

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Get the commit message
COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Conventional commit pattern
# Format: type(scope): subject
# type: feat, fix, docs, style, refactor, perf, test, chore, ci, build
# scope: optional
# subject: required
PATTERN="^(feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert)(\(.+\))?: .{1,}$"

# Check if commit message matches conventional commit format
if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
  echo "${RED}❌ Commit message does not follow Conventional Commits format${NC}"
  echo ""
  echo "${YELLOW}Expected format:${NC}"
  echo "  <type>(<scope>): <subject>"
  echo ""
  echo "${YELLOW}Where type is one of:${NC}"
  echo "  feat     - A new feature"
  echo "  fix      - A bug fix"
  echo "  docs     - Documentation changes"
  echo "  style    - Code style changes (formatting, etc.)"
  echo "  refactor - Code refactoring"
  echo "  perf     - Performance improvements"
  echo "  test     - Adding or updating tests"
  echo "  chore    - Maintenance tasks"
  echo "  ci       - CI/CD changes"
  echo "  build    - Build system changes"
  echo "  revert   - Revert a previous commit"
  echo ""
  echo "${YELLOW}Examples:${NC}"
  echo "  feat: add user authentication"
  echo "  feat(api): add new endpoint for users"
  echo "  fix: resolve navigation bug"
  echo "  docs: update README with setup instructions"
  echo ""
  echo "${YELLOW}Your commit message:${NC}"
  echo "  $COMMIT_MSG"
  echo ""
  exit 1
fi

echo "${GREEN}✓ Commit message follows Conventional Commits format${NC}"
exit 0